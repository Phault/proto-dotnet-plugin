use std::path::PathBuf;

use extism_pdk::*;
use proto_pdk::{host_env, HostEnvironment};

#[host_fn]
extern "ExtismHost" {
    fn get_env_var(name: String) -> String;
}

pub fn get_dotnet_root(env: &HostEnvironment) -> Result<PathBuf, Error> {
    // Variable returns a real path
    Ok(host_env!("DOTNET_ROOT")
        .map(PathBuf::from)
        // So we need our fallback to also be a real path
        .unwrap_or_else(|| env.home_dir.real_path().unwrap().join(".dotnet")))
}

/// Ancient SDK versions not available through git tags.
pub const ANCIENT_VERSIONS: &[&str] = &[
    "1.0.0-preview2-003121",
    "1.0.0-preview2-003131",
    "1.0.0-preview2-003148",
    "1.0.0-preview2-003156",
    "1.0.0-preview2.1-003177",
    "1.0.1",
    "1.0.4",
    "1.1.10",
    "1.1.11",
    "1.1.12",
    "1.1.13",
    "1.1.14",
    "1.1.4",
    "1.1.5",
    "1.1.7",
    "1.1.8",
    "1.1.9",
    "2.0.0",
    "2.0.0-preview1-005977",
    "2.0.0-preview2-006497",
    "2.0.3",
    "2.1.100",
    "2.1.101",
    "2.1.102",
    "2.1.103",
    "2.1.104",
    "2.1.105",
    "2.1.200",
    "2.1.201",
    "2.1.202",
    "2.1.3",
    "2.1.300",
    "2.1.300-preview1-008174",
    "2.1.300-preview2-008533",
    "2.1.300-rc1-008673",
    "2.1.301",
    "2.1.302",
    "2.1.4",
    "2.1.401",
    "2.1.402",
    "2.1.403",
    "2.1.500",
    "2.1.502",
    "2.1.503",
    "2.1.504",
    "2.1.505",
    "2.1.506",
    "2.1.507",
    "2.1.600-preview-009426",
    "2.1.602",
    "2.1.603",
    "2.1.604",
    "2.1.607",
    "2.1.700",
    "2.1.701",
    "2.1.801",
    "2.1.802",
    "2.1.803",
    "2.1.804",
    "2.1.805",
    "2.1.806",
    "2.1.807",
    "2.1.808",
    "2.1.809",
    "2.1.810",
    "2.1.811",
    "2.1.812",
    "2.1.813",
    "2.1.814",
    "2.1.815",
    "2.1.816",
    "2.1.818",
    "2.2.100",
    "2.2.100-preview1-009349",
    "2.2.100-preview2-009404",
    "2.2.100-preview3-009430",
    "2.2.101",
    "2.2.102",
    "2.2.103",
    "2.2.104",
    "2.2.105",
    "2.2.106",
    "2.2.107",
    "2.2.200-preview-009648",
    "2.2.202",
    "2.2.203",
    "2.2.204",
    "2.2.207",
    "2.2.300",
    "2.2.401",
    "2.2.402",
];
